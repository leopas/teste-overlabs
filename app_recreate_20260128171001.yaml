properties:
  environmentId: /subscriptions/06cd0a82-44bf-42fe-ab19-2851e9301697/resourceGroups/rg-overlabs-prod/providers/Microsoft.App/managedEnvironments/env-overlabs-prod-248
  configuration:
    ingress:
      external: true
      targetPort: 8000
      transport: http
    registries:
    - server: acrchoperia.azurecr.io
      username: acrchoperia
      passwordSecretRef: acr-password
    secrets:
    - name: acr-password
      value: LZgpBETBTvDKE91cl+XLJdVP4Lt9dgakHcFcBM8YXv+ACRA7dHk7
  template:
    containers:
    - name: api
      image: acrchoperia.azurecr.io/choperia-api:latest
      env:
      - name: QDRANT_URL
        value: "http://app-overlabs-qdrant-prod-248:6333"
      - name: REDIS_URL
        value: "redis://app-overlabs-redis-prod-248:6379/0"
      - name: DOCS_ROOT
        value: "/app/DOC-IA"
      - name: OPENAI_API_KEY
        value: "@Microsoft.KeyVault(SecretUri=https://kv-overlabs-prod-248.vault.azure.net/secrets/openai-api-key/)"
      - name: USE_OPENAI_EMBEDDINGS
        value: "true"
      - name: LOG_LEVEL
        value: "INFO"
      - name: AUDIT_LOG_ENABLED
        value: "1"
      resources:
        cpu: 2.0
        memory: 4.0Gi
      volumeMounts:
      - volumeName: docs
        mountPath: /app/DOC-IA
    scale:
      minReplicas: 1
      maxReplicas: 5
    volumes:
    - name: docs
      storageType: AzureFile
      storageName: documents-storage